<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manpower</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  <link rel="stylesheet" href="style.css">
  </head>
  <body style="font-size: 12px !important;">
    <h3 class="mt-2" style="text-align: center;">Manpower Analysis</h3>
    <!-- <div id="spinner" class="spinner-border text-primary" role="status">
      <span class="sr-only"></span>
    </div> -->
    <div class="dropdown bgCustom p-2 mb-2 text-center">
      <label for="envSelect">Environment:</label>
      <select id="envSelect">
        <option value="dev">Development</option>
        <option value="prod">Production</option>
      </select>
    </div>
    <ul class="nav nav-tabs" style="justify-content: center;" role="tablist">
      <li class="nav-item" role="presentation">
        <a class="nav-link active" id="simple-tab-0" data-bs-toggle="tab" href="#simple-tabpanel-0" role="tab" aria-controls="simple-tabpanel-0" aria-selected="true"><strong>CDMS</strong></a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="simple-tab-1" data-bs-toggle="tab" href="#simple-tabpanel-1" role="tab" aria-controls="simple-tabpanel-1" aria-selected="false"><strong>SAP</strong></a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="simple-tab-2" data-bs-toggle="tab" href="#simple-tabpanel-2" role="tab" aria-controls="simple-tabpanel-2" aria-selected="false"><strong>STAGING</strong></a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="simple-tab-3" data-bs-toggle="tab" href="#simple-tabpanel-3" role="tab" aria-controls="simple-tabpanel-3" aria-selected="false"><strong>FINAL</strong></a>
      </li>
      <li class="nav-item" role="presentation">
        <a class="nav-link" id="simple-tab-3" data-bs-toggle="tab" href="#simple-tabpanel-4" role="tab" aria-controls="simple-tabpanel-4" aria-selected="false"><strong>CUSTOM</strong></a>
      </li>
    </ul>
    <div class="tab-content p-3" id="tab-content">
      <div class="tab-pane active" id="simple-tabpanel-0" role="tabpanel" aria-labelledby="simple-tab-0">
        <div id="cdms" class="container">
          <h2>New/Update</h2>
          <input type="text" id="mobileNumberM" placeholder="Mobile Number" />
          <button class="btn btn-success fetchData" data-type="cdms">Fetch Data</button>
          <button class="btn btn-warning clear" data-target="#mobileNumberM, #responseBoxM">Clear</button>
          <div style="margin-top: 5px" class="response" id="responseBoxM">
            Response will appear here...
          </div>
        </div>
      </div>
      <div class="tab-pane" id="simple-tabpanel-1" role="tabpanel" aria-labelledby="simple-tab-1">
        <div id="sap" class="container">
          <h2>SAP</h2>
          <input type="text" id="dealerCodeS" placeholder="Dealer Code" />
          <button class="btn btn-success fetchData" data-type="sap">Fetch Data</button>
          <button class="btn btn-warning clear" data-target="#dealerCodeS, #responseBoxS">Clear</button>
          <div style="margin-top: 5px" class="response" id="responseBoxS">
            Response will appear here...
          </div>
        </div>
      </div>
      <div class="tab-pane" id="simple-tabpanel-2" role="tabpanel" aria-labelledby="simple-tab-2">
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active" id="simple-tab-SNU" data-bs-toggle="tab" href="#simple-tabpanel-new-updt-stg" role="tab" aria-controls="simple-tabpanel-new-updt-stg" aria-selected="true">NEW/UPDATE</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="simple-tab-ST" data-bs-toggle="tab" href="#simple-tabpanel-terminated-stg" role="tab" aria-controls="simple-tabpanel-terminated-stg" aria-selected="false">TERMINATE</a>
          </li>
        </ul>
        <div class="tab-content p-3" id="tab-content">
          <div class="tab-pane active" id="simple-tabpanel-new-updt-stg" role="tabpanel" aria-labelledby="simple-tab-new-updt-stg">
            <div id="new-stg" class="container">
              <h2>New/Update</h2>
              <input type="text" id="mobileNumberN" placeholder="Mobile Number" />
              <button class="btn btn-success fetchData" data-type="new-stg">Fetch Data</button>
              <button class="btn btn-warning clear" data-target="#mobileNumberN, #responseBoxN">Clear</button>
              <div style="margin-top: 5px" class="response" id="responseBoxN">
                Response will appear here...
              </div>
            </div>
          </div>
          <div class="tab-pane" id="simple-tabpanel-terminated-stg" role="tabpanel" aria-labelledby="simple-tab-terminated-stg">
            <div id="terminate-stg" class="container">
              <h2>Terminate</h2>
              <input type="text" id="mobileNumberG" placeholder="Mobile Number" />
              <button class="btn btn-success fetchData" data-type="terminatedG">Fetch Data</button>
              <button class="btn btn-warning clear" data-target="#mobileNumberG, #responseBoxG">Clear</button>
              <div style="margin-top: 5px" class="response" id="responseBoxG">
                Response will appear here...
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="tab-pane" id="simple-tabpanel-3" role="tabpanel" aria-labelledby="simple-tab-3">
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active" id="simple-tab-0" data-bs-toggle="tab" href="#simple-tabpanel-new" role="tab" aria-controls="simple-tabpanel-new" aria-selected="true">NEW</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="simple-tab-0" data-bs-toggle="tab" href="#simple-tabpanel-updt" role="tab" aria-controls="simple-tabpanel-updt" aria-selected="false">UPDATE</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="simple-tab-0" data-bs-toggle="tab" href="#simple-tabpanel-terminated" role="tab" aria-controls="simple-tabpanel-terminated" aria-selected="false">TERMINATE</a>
          </li>
        </ul>
        <div class="tab-content p-3" id="tab-content">
          <div class="tab-pane active" id="simple-tabpanel-new" role="tabpanel" aria-labelledby="simple-tab-new">
            <div id="new" class="container">
              <h2>New</h2>
              <input type="text" id="mobileNumber" placeholder="Mobile Number" />
              <button class="btn btn-success fetchData" data-type="new">Fetch Data</button>
              <button class="btn btn-warning clear" data-target="#mobileNumber, #responseBox">Clear</button>
              <div style="margin-top: 5px" class="response" id="responseBox">
                Response will appear here...
              </div>
            </div>
          </div>
          <div class="tab-pane" id="simple-tabpanel-updt" role="tabpanel" aria-labelledby="simple-tab-updt">
            <div id="updt" class="container">
              <h2>Update</h2>
              <input type="text" id="mobileNumberU" placeholder="Mobile Number" />
              <button class="btn btn-success fetchData" data-type="updt">Fetch Data</button>
              <button class="btn btn-warning clear" data-target="#mobileNumberU, #responseBoxU">Clear</button>
              <div style="margin-top: 5px" class="response" id="responseBoxU">
                Response will appear here...
              </div>
            </div>
          </div>
          <div class="tab-pane" id="simple-tabpanel-terminated" role="tabpanel" aria-labelledby="simple-tab-terminated">
            <div id="terminated" class="container">
              <h2>Terminate</h2>
              <input type="text" id="mobileNumberT" placeholder="Mobile Number" />
              <button class="btn btn-success fetchData" data-type="terminated">Fetch Data</button>
              <button class="btn btn-warning clear" data-target="#mobileNumberT, #responseBoxT">Clear</button>
              <div style="margin-top: 5px" class="response" id="responseBoxT">
                Response will appear here...
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="tab-pane" id="simple-tabpanel-4" role="tabpanel" aria-labelledby="simple-tab-4">
        <div id="sap" class="container">
          <h2>CUSTOM</h2>
          <textarea type="text" id="customText" placeholder="Enter custom query" class="w-100"></textarea>
          <button class="btn btn-success fetchData" data-type="custom">Fetch Data</button>
          <button class="btn btn-warning clear" data-target="#responseBoxC">Clear</button>
          <div style="margin-top: 5px" class="response" id="responseBoxC">
            Response will appear here...
          </div>
        </div>
      </div>
    </div>
    <script>
      var envHost = {
        prod: "https://api.bajajauto.com/dwh-sapi",
        dev: "https://apidev.bajajauto.com/dwh-sapi-dev",
      };

      $(document).ready(function () {
        $(".clear").click(function () {
          var targets = $(this).data("target").split(", ");
          targets.forEach(function (target) {
            $(target).val("").html("Response will appear here...");
          });
        });

        $("#envSelect").change(function () {
          var selectedEnv = $(this).val();
          $(".fetchData").data("host", envHost[selectedEnv]);
          $(".clear").click();
        });

        $(".fetchData").click(function () {
          var type = $(this).data("type");
          var host = $(this).data("host") || envHost["dev"];
          var inputId = type === "sap" ? "#dealerCodeS" : type === "custom" ? "#customText" : "#mobileNumber" + (type === "new" ? "" : type.charAt(0).toUpperCase());
          var responseBoxId = type === "custom" ? "#responseBoxC" : "#responseBox" + (type === "new" ? "" : type.charAt(0).toUpperCase());
          var inputValue = $(inputId).val();
          if(inputValue == '' || inputValue == null){
            alert('Please enter the value');
            return;
          }
          var query = getQuery(type, inputValue);

          fetchData(host, query, responseBoxId);
        });

        function getQuery(type, value) {
          switch (type) {
            case "new":
              return "SELECT Branch_City, CDMS_Hub_Name, CDMS_BU, CDMS_Branch_Name, IsLSQLive, [Sales ASM Email], DATALOADTIME, MPM_Key_Id FROM MPM_CDMS_LSQ_DATA_NEW WHERE Mobile_10_D_Number IN ('" + value + "')";
            case "updt":
              return "SELECT Branch_City, CDMS_Hub_Name, CDMS_BU, CDMS_Branch_Name, IsLSQLive, [Sales ASM Email], DATALOADTIME, MPM_Key_Id FROM MPM_CDMS_LSQ_DATA_UPDT WHERE Mobile_10_D_Number IN ('" + value + "')";
            case "terminated":
              return "SELECT Branch_City, CDMS_Hub_Name, CDMS_BU, CDMS_Branch_Name, IsLSQLive, [Sales ASM Email], DATALOADTIME, Termination_Date, MPM_Key_Id FROM MPM_CDMS_LSQ_TERMINATED WHERE Mobile_10_D_Number IN ('" + value + "')";
            case "sap":
              return "SELECT SAL_HUB, HUB, KUNNR as DealerCode, EMAIL as [Sales ASM Email] FROM SAP_ZSD_DEALER_REPOS WHERE KUNNR IN ('" + value + "')";
            case "new-stg":
              return "SELECT Branch_City, CDMS_Hub_Name, CDMS_BU, CDMS_Branch_Name, IsLSQLive, [Sales ASM Email], DATALOADTIME, MPM_Key_Id FROM MPM_CDMS_LSQ_DATA WHERE Mobile_10_D_Number IN ('" + value + "')";
            case "terminatedG":
              return "SELECT Branch_City, CDMS_Hub_Name, CDMS_BU, CDMS_Branch_Name, IsLSQLive, [Sales ASM Email], DATALOADTIME, Termination_Date, MPM_Key_Id FROM MPM_CDMS_LSQ_TERMINATED_STG WHERE Mobile_10_D_Number IN ('" + value + "')";
            case "cdms":
              return "SELECT Branch_City, CDMS_Hub_Name, CDMS_BU, CDMS_Branch_Name, IsLSQLive, [Sales ASM Email], DATALOADTIME, Termination_Date, MPM_Key_Id FROM MPM_CDMS_LSQ_TERMINATED_STG WHERE Mobile_10_D_Number IN ('" + value + "')";
            case "custom":
              return value;
            default:
              return "";
          }
        }

        function fetchData(host, query, responseBoxId) {
          var requestData = {
            query: query,
            message: "MANPOWER DATA",
          };

          // Show the spinner
          $("#spinner").show();

          $.ajax({
            url: host + "/api/v1/get-data",
            type: "POST",
            contentType: "application/json",
            headers: {
              client_id: "6b5cb7c7c23241efb39b2304769ecea5",
              client_secret: "95EF718e1ed64c3a980926174214B379",
            },
            data: JSON.stringify(requestData),
            success: function (response) {
              var data = response.data;
              if (Array.isArray(data) && data.length > 0) {
                var table = "<table class='table' border=0><thead><tr>";
                var filterRow = "<tr>";

                Object.keys(data[0]).forEach((key, index) => {
                  table += "<th>" + key + "<br><input type='text' class='filter-input' data-index='" + index + "' placeholder='Search...'></th>";
                  filterRow += "<td></td>"; // For maintaining structure
                });

                table += "</tr></thead><tbody>";
                data.forEach((row) => {
                  table += "<tr>";
                  Object.values(row).forEach((value) => {
                    table += "<td>" + value + "</td>";
                  });
                  table += "</tr>";
                });
                table += "</tbody></table>";
                $(responseBoxId).html(table);

                // Filtering logic
                $(".filter-input").on("keyup", function () {
                  var columnIndex = $(this).data("index");
                  var filterValue = $(this).val().toLowerCase();

                  $("tbody tr").each(function () {
                    var cellText = $(this).find("td").eq(columnIndex).text().toLowerCase();
                    $(this).toggle(cellText.indexOf(filterValue) > -1);
                  });
                });
              } else {
                $(responseBoxId).html("<pre>No data found</pre>");
              }
            },
            error: function (xhr, status, error) {
              $(responseBoxId).html('<span style="color:red;">Error fetching data: ' + error + "</span>");
            },
            complete: function () {
              // Hide the spinner once API call is complete
              $("#spinner").hide();
            },
          });
        }
      });
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>